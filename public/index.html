<!DOCTYPE html>
<html ng-app="app">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>MIB</title>
    <link rel="stylesheet" href="/css/app.css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css">
  </head>
  <body ng-controller="BoardController as board">
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation"
      ng-controller="NavigationController as nav">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#" ng-click="board.closeImport()">{{board.name}}</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a ng-hide="nav.session.loggedIn" href="/auth/github">Login</a></li>
            <li><a ng-show="nav.session.loggedIn" ng-click="board.startImport()" href="#">Import</a></li>
            <li><a ng-show="nav.session.loggedIn" href="/logout">Logout {{nav.session.uid}}</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    <div class="container-fluid">
      <div ng-show="board.importing" id="import">
        <a href="#" style="color:black;" class="pull-right" ng-click="board.closeImport()"><i class="glyphicon glyphicon-remove"></i></a>
        <h4>Importing into: <b>{{board.columns[board.importCol].name}}</b></h4>
        <p>{{board.importHelp}}</p>
        <a href="#" ng-hide="board.importProvider" ng-repeat="provider in board.availableImportProviders" ng-click="provider.next()">{{provider.name}}</a>
        <a href="#" ng-show="board.importPersonalOrOrg" ng-click="board.importProvider.personal()">Personal</a>
        <a href="#" ng-show="board.importPersonalOrOrg" ng-click="board.importProvider.org()">Organization</a>
        <a href="#" ng-show="board.importOrgs" ng-repeat="org in board.importOrgs" ng-click="board.importProvider.selectOrg(org)" style="display:block">{{org.login}}</a>
        <div class="btn-group" ng-if="board.importReposLinks">
          <button class="btn btn-default" ng-if="board.importReposLinks.prev" ng-click="board.importProvider.getReposPrev()">previous</button>
          <button class="btn btn-default" ng-if="board.importReposLinks.next" ng-click="board.importProvider.getReposNext()">next</button>
        </div>
        <button ng-disabled="repo.imported" ng-show="board.importRepos" ng-repeat="repo in board.importRepos" ng-click="board.importProvider.importRepo(repo)" style="display:block" class="btn btn-default btn-lg btn-block">{{repo.full_name}}</button>
      </div>
      <table class="table">
        <thead>
          <th style="text-align:center" ng-repeat="column in board.columns">
            <b>{{column.name}}</b>
          </th>
        </thead>
        <tbody>
          <tr>
            <td ng-repeat="column in board.columns" ng-init="col = $index">
              <ul class="list-group">
                <li class="list-group-item" ng-repeat="card in column.cards" ng-init="row = $index">
                  <span class="badge">{{card.comments}}</span>
                  <a class="pull-left" href="{{card.html_url}}" target="_blank">{{card.title}}</a>
                  <br>
                  <div class="btn-group">
                    <button
                      class="btn btn-default btn-xs"
                      ng-if="col > 0" 
                      ng-click="board.moveCard('left', col, row)">
                      <i class="glyphicon glyphicon-arrow-left"></i>
                    </button>
                    <!--
                    <button
                      class="btn btn-default btn-xs"
                      style="color:red"
                      ng-click="board.removeCard(col, row)">
                      <i class="glyphicon glyphicon-remove-sign"></i>
                    </button>
                    <button
                      class="btn btn-default btn-xs"
                      ng-click="board.logCard(card)">
                      <i class="glyphicon glyphicon-wrench"></i>
                    </button>
                    -->
                    <button
                      class="btn btn-default btn-xs"
                      ng-hide="row === column.cards.length-1"
                      ng-click="board.moveCard('down', col, row)">
                      <i class="glyphicon glyphicon-arrow-down"></i>
                    </button>
                    <button
                      class="btn btn-default btn-xs"
                      ng-hide="row === 0"
                      ng-click="board.moveCard('up', col, row)">
                      <i class="glyphicon glyphicon-arrow-up"></i>
                    </button>
                    <button
                      class="btn btn-default btn-xs"
                      ng-if="col !== board.columns.length-1"
                      ng-click="board.moveCard('right', col, row)">
                      <i class="glyphicon glyphicon-arrow-right"></i>
                    </button>
                  </div>
                </li>   
              </ul>
            </td>
          </tr>
        </tbody>
      </table>
    </div><!-- /.container -->
    <script src="/socket.io/socket.io.js" type="text/javascript" charset="utf-8"></script>
    <script src="/js/angular.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="/js/bundle.js" type="text/javascript" charset="utf-8"></script>
  </body>
</html>
